/*!
 * Paper Plane v0.1.0
 * 2013-07-04
 * http://11am.github.com/paper-plane
 * Copyright (c) 2013
 * Arne SchlÃ¼ter; Licensed MIT
!*/

!function(a,b){var c,d,e,f,g=b.getElementById("paperscript"),h=b.getElementById("plane"),i=b.getElementById("paper"),j=b.getElementById("load"),k="drawings",l={},m="drawing-",n=0,o={lineNumbers:!0,lineWrapping:!0,electricChars:!0,tabSize:2,theme:"monokai",extraKeys:{"Ctrl-Enter":"runScript","Ctrl-S":"persistDrawing","Ctrl-Y":"loadDrawing"}},p=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},q=function(){var a=paper.PaperScope.get(g);if(a){var b=e.getValue();g.innerHTML=b;var c=function(){a.clear(),a.initialize(g),a.setup(i)};if(b!==f)try{c(),a.evaluate(b),f=b}catch(d){throw c(),a.evaluate(f),d}}},r=function(){l=JSON.parse(localStorage.getItem(k)),n=0;for(var a in l)p(l,a)&&(l[a]=JSON.parse(l[a]),n++);n>0&&j.parentElement.classList.remove("hidden")},s=function(a){return l[m+a]},t=function(a){a.alreadySaved=!0,l[m+a.name]=a;var b=Object.create(l);for(var c in l)p(l,c)&&(b[c]=JSON.stringify(l[c]));localStorage.setItem(k,JSON.stringify(b))},u=function(a,b,c){this.name=a,this.content=b,this.alreadySaved=!!c};u.prototype.setName=function(){this.name=window.prompt("Enter a name for your drawing:")},u.prototype.continueWithName=function(){return!this.alreadySaved&&s(this.name)?window.confirm('There is already a drawing with the name "'+this.name+'".\n'+"Do you want to overwrite it?"):!0},u.prototype.save=function(){return this.alreadySaved||(this.setName(),this.name&&this.continueWithName())?(this.content=e.getValue(),t(this),r(),void 0):(this.name="",void 0)},u.load=function(a){var b=s(a);return new u(b.name,b.content,!0)};var v=function(){c.save()},w=function(a,b){b||(b=window.prompt("Enter the script to be loaded")),c=u.load(b),a.setValue(c.content),q()},x=function(a,b){var c,d;return function(){var e=this,f=arguments,g=function(){c=null,d=a.apply(e,f)};return clearTimeout(c),c=setTimeout(g,b),d}};CodeMirror.commands.runScript=q,CodeMirror.commands.persistDrawing=v,CodeMirror.commands.loadDrawing=w;var y=function(){e=CodeMirror.fromTextArea(h,o),d=b.querySelector(".CodeMirror"),e.on("change",x(q,500)),e.focus(),e.setCursor(e.lastLine(),0),c=new u,localStorage.getItem(k)?r():localStorage.setItem(k,JSON.stringify(l))};y()}(window,document);
/*
//@ sourceMappingURL=js/source.js
*/